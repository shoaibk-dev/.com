<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.53"><link rel=author href=../../humans.txt><link rel=icon href=../../images/kit_logo.png><title>Boost Docker CI Build Speed to ~10X times - KhanhIceTea B(rain)-log</title><meta property=og:title content="Boost Docker CI Build Speed to ~10X times - KhanhIceTea B(rain)-log"><meta property=og:type content=article><meta property=og:url content=https://khanhicetea.com/post/boost-docker-ci-build-speed-to-10x/><meta name=description content="As an software engineering developer, you know that automated CI testing is the one of keys to improve software release life cycle."><meta property=og:description content="As an software engineering developer, you know that automated CI testing is the one of keys to improve software release life cycle."><meta property=og:image content=https://khanhicetea.comimages//images/2019/01/continuous-integration.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,400i,500,700,700i&amp;subset=vietnamese" rel=stylesheet><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css><link href="../../css/medium.css?v=1560872668" rel=stylesheet><link href="../../css/additional.css?v=1560872668" rel=stylesheet></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=https://khanhicetea.com><img src=../../images/kit_logo.png alt=logo>
<span>KhanhIceTea B(rain)-log</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=../../>Home</a></li><li class=nav-item><a class=nav-link href=https://github.com/khanhicetea>Github</a></li><li class=nav-item><a class=nav-link href=../../php-0-to-1/>Learn PHP</a></li><li class=nav-item><a class=nav-link href=../../til/>Today I Learned</a></li></ul></div></div></nav><div class=site-content><div class=container><div class=main-content><div class=container><div class=row><div class="col-lg-2 col-md-0 pl-0"><div class=share><p>Share</p><ul><li class="ml-1 mr-1"><a target=_blank href="https://twitter.com/intent/tweet?text=Boost%20Docker%20CI%20Build%20Speed%20to%20~10X%20times&url=https%3a%2f%2fkhanhicetea.com%2fpost%2fboost-docker-ci-build-speed-to-10x%2f" onclick="window.open(this.href,'twitter-share','width=550,height=435');return false;"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://facebook.com/sharer.php?u=https%3a%2f%2fkhanhicetea.com%2fpost%2fboost-docker-ci-build-speed-to-10x%2f" onclick="window.open(this.href,'facebook-share','width=550,height=435');return false;"><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://plus.google.com/share?url=https%3a%2f%2fkhanhicetea.com%2fpost%2fboost-docker-ci-build-speed-to-10x%2f" onclick="window.open(this.href,'google-share','width=550,height=435');return false;"><i class="fab fa-google"></i></a></li></ul><div class=sep></div><div id=toc-container><p>Table of Contents</p></div><ul><li><a class="small smoothscroll" href=#disqus_thread></a></li></ul></div></div><div class="col-lg-10 col-md-12 flex-first flex-md-unordered"><div class=mainheading><h1 class=posttitle>Boost Docker CI Build Speed to ~10X times</h1></div><div class=post-top-meta><i class="far fa-keyboard"></i>Jan 17, 2019
<i class="far fa-clock clock"></i>5 mins read
<i class="fas fa-code-branch git-commit-hash"></i><a class=git-commit-hash-link title="[2019-01-30 12:27:54 &#43;0700 &#43;0700] fix typo" href=https://github.com/khanhicetea/.com/blob/928033f383ee610f4385531f9ea9025198ddf60c/content/post/Boost-Docker-CI-build-speed-to-10X.md target=_blank>928033f38</a></div><img class="featured-image img-fluid" src=../../images/2019/01/continuous-integration.png alt="thumbnail for this post"><div class=article-post><p>As an software engineering developer, you know that automated CI testing is one of keys to improve software release life-cycle.</p><p>But sometimes reality is not as good as you think, CI testing speed is slow (3-10 minutes / build) and it slows the release cycle speed down. And you try to look into your build logs to find out what causes the problem. Then you got it, it’s mostly the DATABASE service (MySQL, Postgres, MongoDB, …)</p><p>I will summarize some stages of your database in a testing build:</p><ul><li>First, it initializes the data, loads config and listens to the connections (takes around 10-45 seconds)</li><li>Second, that you import your testing database into the server (including schemas and initialized data) takes around 20-60 seconds</li><li>Then, on each test case, it needs to clear all data then re-imports fixture data (takes around 30-120 seconds)</li></ul><p>So how to make these servers run as fast as possible like some Key-Value databases do? (Redis, Memcached). The main different point is the MEMORY! What if we put all data inside memory??</p><p>All of we know that RAM speed with 150 times lower latency is <a href=https://www.theregister.co.uk/2016/04/21/storage_approaches_memory_speed_with_xpoint_and_storageclass_memory/>technically better than SSD and HDD speed</a>. And as a matter of fact, Linux is a good OS that supports a lot of filesystems, specially tmpfs, which you can mount files into your RAM memory.</p><p>However, nothing is perfect and this is not an exception. Actually, it is not a good option for persistent data which is not necessary for testing database. What it really needs is speed only, so it fits in.</p><p>That’s my idea, now I will try to test it on my CI environment (I use <a href=https://github.com/drone/drone>DroneCI</a> using Docker). In new version 0.8+ of DroneCI, they support us to run docker containers within <strong>tmpfs mount</strong>.</p><p>So I just add this line into my drone config</p><pre><code class=language-yml>services:
  testdatabase:
    image: mysql:5.7
    # Add this 2 lines below to boost your database container
    tmpfs:
      - /var/lib/mysql
    environment:
      - MYSQL_DATABASE=testdb
      - MYSQL_ROOT_PASSWORD=passwd
</code></pre><p><strong>Result</strong>:</p><ul><li>MySQL service initializes in 3 seconds instead of 25 seconds</li><li>Import testing database using mysql client takes below 1 second instead of 17 seconds</li><li>My test cases run 20-30% faster (I have few testcases using database)</li></ul><blockquote><p>So, worth a shot !!</p></blockquote><hr><p><strong>Ref:</strong></p><ul><li>Cover photo from <a href=https://dotnetvibes.com/2018/04/10/continuous-delivery-is-not-continuous-deployment/>dotnetvibes.com</a></li></ul></div><div class=after-post-tags><ul class=tags><li><a href=../../tags/docker>docker</a></li><li><a href=../../tags/ci>ci</a></li><li><a href=../../tags/linux>linux</a></li><li><a href=../../tags/tmpfs>tmpfs</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" href=../../til/2019-02-02-can-not-run-downloaded-binary-inside-alpine-linux-because-of-missing-shared-libs/>&laquo; #TIL : Can not run downloaded binary inside alpine linux because of missing shared libs</a>
<a class="next d-block col-md-6 text-lg-right" href=../../post/refactoring-code-day-2/>Refactoring Code - Day 2 - Các nguyên lý cơ bản trong refactoring &raquo;</a><div class=clearfix></div></div><div style=margin-top:10px;margin-bottom:10px><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-6074006947927745 data-ad-slot=8493558457 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div></div></div><div class=container><div id=comments class="row justify-content-center mb-5"><div class="col-lg-2 col-md-0"></div><div class="col-lg-10 col-md-12"><div id=disqus_thread></div><script type=text/javascript>(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='khanhicetea';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div></div><div class="jumbotron fortags"><div class="d-flex h-100"><div class="col-md-4 align-self-center text-center h-100"><div class="d-flex align-items-center justify-content-center h-100"><h2 class="d-md-block d-none align-self-center">Explore →</h2></div></div><div class="col-md-8 align-self-center text-center"><a href=../../tags/sysadmin>sysadmin [39]</a>
<a href=../../tags/english>english [27]</a>
<a href=../../tags/vietnamese>vietnamese [20]</a>
<a href=../../tags/php>php [16]</a>
<a href=../../tags/bash>bash [15]</a>
<a href=../../tags/life>life [15]</a>
<a href=../../tags/web>web [14]</a>
<a href=../../tags/docker>docker [13]</a>
<a href=../../tags/devops>devops [11]</a>
<a href=../../tags/javascript>javascript [11]</a>
<a href=../../tags/linux>linux [11]</a>
<a href=../../tags/python>python [11]</a>
<a href=../../tags/mysql>mysql [10]</a>
<a href=../../tags/networking>networking [10]</a>
<a href=../../tags/database>database [9]</a>
<a href=../../tags/security>security [7]</a>
<a href=../../tags/shell>shell [7]</a>
<a href=../../tags/ci>ci [5]</a>
<a href=../../tags/debug>debug [5]</a>
<a href=../../tags/dns>dns [5]</a>
<a href=../../tags/git>git [5]</a>
<a href=../../tags/http>http [5]</a>
<a href=../../tags/leby>leby [5]</a>
<a href=../../tags/string>string [5]</a>
<a href=../../tags/ansible>ansible [4]</a>
<a href=../../tags/curl>curl [4]</a>
<a href=../../tags/inspiration>inspiration [4]</a>
<a href=../../tags/random>random [4]</a>
<a href=../../tags/system>system [4]</a>
<a href=../../tags/tool>tool [4]</a></div></div></div><footer class=footer><div class=container><div class=row><div class="col-md-6 col-sm-6 text-center text-lg-left">2019 &copy; KhanhIceTea - Licensed under CC BY-NC-ND 3.0 | In God We Trust</div><div class="col-md-6 col-sm-6 text-center text-lg-right">Powered by <a href=http://gohugo.io target=_blank>Hugo</a> and <a target=_blank href=https://www.wowthemes.net>Mediumish</a> by WowThemes.net</div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.6/typed.min.js></script><script src=../../js/sqdiagram.js></script><script src=../../js/mediumish.js></script><script src=../../js/highlight.js></script><script src=../../js/polyfill.min.js></script><script>$(document).ready(function(){hljs.configure({tabReplace:'    '});$('.article-post pre code').each(function(i,block){hljs.highlightBlock(block);});$(".article-post p").has("img").css('text-align',"center");$(".article-post a").attr('target','_blank');$(".article-post table").addClass('table').addClass('table-bordered');$(".sqdiagram").sequenceDiagram({theme:'hand'});if(window.typedString){var typed=new Typed('#currentStatus',{strings:window.typedString,typeSpeed:70,startDelay:500,showCursor:true,cursorChar:'_',autoInsertCss:true,onComplete:function(){console.log('ok');$('#currentStatus a').click(function(e){var link=$(this).attr('href');e.preventDefault();ga('send','event','Timeline','click_link',link);setTimeout(function(){window.location=link;},100);});}});}});</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-50390703-1','auto');jQuery.ajax({url:"https://extreme-ip-lookup.com/json/",jsonp:"callback",dataType:"jsonp",success:function(geoip){ga('set','dimension1',geoip.query);ga('set','dimension2',geoip.city+' - '+geoip.country);ga('send','pageview');setInterval(function(){ga('send','pageview');},60000);}});</script></body></html>