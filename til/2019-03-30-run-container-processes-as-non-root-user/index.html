<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.53"><link rel=author href=../../humans.txt><link rel=icon href=../../images/kit_logo.png><title>#TIL : Run container processes as non-root user - KhanhIceTea B(rain)-log</title><meta property=og:title content="#TIL : Run container processes as non-root user - KhanhIceTea B(rain)-log"><meta property=og:type content=article><meta property=og:url content=https://khanhicetea.com/til/2019-03-30-run-container-processes-as-non-root-user/><meta name=description content="I learned on 2019-03-30 about docker, root, linux"><meta property=og:description content="I learned on 2019-03-30 about docker, root, linux"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,400i,500,700,700i&amp;subset=vietnamese" rel=stylesheet><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css><link href="../../css/medium.css?v=1560872668" rel=stylesheet><link href="../../css/additional.css?v=1560872668" rel=stylesheet></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down"><div class="container pr-0"><a class=navbar-brand href=https://khanhicetea.com><img src=../../images/kit_logo.png alt=logo>
<span>KhanhIceTea B(rain)-log</span></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarMediumish aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=../../>Home</a></li><li class=nav-item><a class=nav-link href=https://github.com/khanhicetea>Github</a></li><li class=nav-item><a class=nav-link href=../../php-0-to-1/>Learn PHP</a></li><li class=nav-item><a class=nav-link href=../../til/>Today I Learned</a></li></ul></div></div></nav><div class=site-content><div class=container><div class=main-content><div class=container><div class=row><div class="col-lg-2 col-md-0 pl-0"><div class=share><p>Share</p><ul><li class="ml-1 mr-1"><a target=_blank href="https://twitter.com/intent/tweet?text=%23TIL%20%3a%20Run%20container%20processes%20as%20non-root%20user&url=https%3a%2f%2fkhanhicetea.com%2ftil%2f2019-03-30-run-container-processes-as-non-root-user%2f" onclick="window.open(this.href,'twitter-share','width=550,height=435');return false;"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://facebook.com/sharer.php?u=https%3a%2f%2fkhanhicetea.com%2ftil%2f2019-03-30-run-container-processes-as-non-root-user%2f" onclick="window.open(this.href,'facebook-share','width=550,height=435');return false;"><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a target=_blank href="https://plus.google.com/share?url=https%3a%2f%2fkhanhicetea.com%2ftil%2f2019-03-30-run-container-processes-as-non-root-user%2f" onclick="window.open(this.href,'google-share','width=550,height=435');return false;"><i class="fab fa-google"></i></a></li></ul><div class=sep></div><div id=toc-container><p>Table of Contents</p><nav id=TableOfContents><ul><li><ul><li><a href=#run-container-processes-as-non-root-user>Run container processes as non-root user</a></li></ul></li></ul></nav></div><ul><li><a class="small smoothscroll" href=#disqus_thread></a></li></ul></div></div><div class="col-lg-10 col-md-12 flex-first flex-md-unordered"><div class=mainheading><h1 class=posttitle>#TIL : Run container processes as non-root user</h1></div><div class=post-top-meta><i class="far fa-keyboard"></i>Mar 30, 2019
<i class="far fa-clock clock"></i>5 mins read
<i class="fas fa-code-branch git-commit-hash"></i><a class=git-commit-hash-link title="[2019-03-30 17:50:01 &#43;0700 &#43;0700] Updated 19.03.30 17:50:01" href=https://github.com/khanhicetea/.com/blob/b0eed04457d5c99700b3d735b7723b4cae49d8b3/content/til/2019-03-30-run-container-processes-as-non-root-user.md target=_blank>b0eed0445</a></div><div class=article-post><h2 id=run-container-processes-as-non-root-user>Run container processes as non-root user</h2><p>As default, docker runs your container as root user (uid=0). Although docker isolates your filesystem to protect docker host, but running processes as root is redundant and increasing attacking surface. Even it can make its written files having root owner, which can mess your docker-host filesystem permission.</p><p>This is example that show docker runs as root</p><pre><code class=language-bash>$ docker run --rm alpine sleep 30
</code></pre><p>and open another terminal to check this</p><pre><code class=language-bash>$ ps xau | grep 'sleep'
khanhic+ 15552  0.5  0.4 1264452 49280 pts/1   Sl+  17:37   0:00 docker run --rm alpine:3.9 sleep 30
root     15610  0.6  0.0   1520     4 ?        Ss   17:37   0:00 sleep 30
khanhic+ 15876  0.0  0.0  23076  1024 pts/2    S+   17:37   0:00 grep --color=auto sleep
</code></pre><p>You can see that the process <strong>sleep 30</strong> is running as root with pid = 15610</p><hr><p>To control which user docker container runs as, you can use the <code>--user [userid]:[groupid]</code> argument</p><p>Example</p><pre><code class=language-bash>$ docker run --rm --user 1000:1000 alpine sleep 30
</code></pre><p>Then you will get this result</p><pre><code class=language-bash>$ ps xau | grep 'sleep'
khanhic+ 16275  2.0  0.4 1411916 50124 pts/1   Sl+  17:41   0:00 docker run --rm --user 1000:1000 alpine:3.9 sleep 30
khanhic+ 16336  1.5  0.0   1520     4 ?        Ss   17:41   0:00 sleep 30
khanhic+ 16403  0.0  0.0  23076   984 pts/2    S+   17:41   0:00 grep --color=auto sleep
</code></pre><p><strong>TIP</strong> : you can set a environment variable by add this line to <strong>~/.bash_profile</strong> or <strong>~/.bashrc</strong></p><pre><code class=language-bash>export DOCKER_UID=&quot;$(id -u ${USER}):$(id -g ${USER})&quot;`
</code></pre><p>then use docker command like <code>docker run --user $DOCKER_UID ....</code></p></div><div class=after-post-tags><ul class=tags><li><a href=../../tags/docker>docker</a></li><li><a href=../../tags/root>root</a></li><li><a href=../../tags/linux>linux</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" href=../../til/2019-04-03-use-nginx-as-a-tcpudp-load-balancer/>&laquo; #TIL : Use NGINX as a TCP,UDP load balancer</a>
<a class="next d-block col-md-6 text-lg-right" href=../../til/2019-03-14-can-not-get-real-ip-address-from-load-balancer-ssl-passthrough/>#TIL : Can not get real IP address from Load Balancer SSL Passthrough &raquo;</a><div class=clearfix></div></div><div style=margin-top:10px;margin-bottom:10px><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-6074006947927745 data-ad-slot=8493558457 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script></div></div></div></div><div class=container><div id=comments class="row justify-content-center mb-5"><div class="col-lg-2 col-md-0"></div><div class="col-lg-10 col-md-12"><div id=disqus_thread></div><script type=text/javascript>(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='khanhicetea';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div></div><div class="jumbotron fortags"><div class="d-flex h-100"><div class="col-md-4 align-self-center text-center h-100"><div class="d-flex align-items-center justify-content-center h-100"><h2 class="d-md-block d-none align-self-center">Explore â†’</h2></div></div><div class="col-md-8 align-self-center text-center"><a href=../../tags/sysadmin>sysadmin [39]</a>
<a href=../../tags/english>english [27]</a>
<a href=../../tags/vietnamese>vietnamese [20]</a>
<a href=../../tags/php>php [16]</a>
<a href=../../tags/bash>bash [15]</a>
<a href=../../tags/life>life [15]</a>
<a href=../../tags/web>web [14]</a>
<a href=../../tags/docker>docker [13]</a>
<a href=../../tags/devops>devops [11]</a>
<a href=../../tags/javascript>javascript [11]</a>
<a href=../../tags/linux>linux [11]</a>
<a href=../../tags/python>python [11]</a>
<a href=../../tags/mysql>mysql [10]</a>
<a href=../../tags/networking>networking [10]</a>
<a href=../../tags/database>database [9]</a>
<a href=../../tags/security>security [7]</a>
<a href=../../tags/shell>shell [7]</a>
<a href=../../tags/ci>ci [5]</a>
<a href=../../tags/debug>debug [5]</a>
<a href=../../tags/dns>dns [5]</a>
<a href=../../tags/git>git [5]</a>
<a href=../../tags/http>http [5]</a>
<a href=../../tags/leby>leby [5]</a>
<a href=../../tags/string>string [5]</a>
<a href=../../tags/ansible>ansible [4]</a>
<a href=../../tags/curl>curl [4]</a>
<a href=../../tags/inspiration>inspiration [4]</a>
<a href=../../tags/random>random [4]</a>
<a href=../../tags/system>system [4]</a>
<a href=../../tags/tool>tool [4]</a></div></div></div><footer class=footer><div class=container><div class=row><div class="col-md-6 col-sm-6 text-center text-lg-left">2019 &copy; KhanhIceTea - Licensed under CC BY-NC-ND 3.0 | In God We Trust</div><div class="col-md-6 col-sm-6 text-center text-lg-right">Powered by <a href=http://gohugo.io target=_blank>Hugo</a> and <a target=_blank href=https://www.wowthemes.net>Mediumish</a> by WowThemes.net</div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.6/typed.min.js></script><script src=../../js/sqdiagram.js></script><script src=../../js/mediumish.js></script><script src=../../js/highlight.js></script><script src=../../js/polyfill.min.js></script><script>$(document).ready(function(){hljs.configure({tabReplace:'    '});$('.article-post pre code').each(function(i,block){hljs.highlightBlock(block);});$(".article-post p").has("img").css('text-align',"center");$(".article-post a").attr('target','_blank');$(".article-post table").addClass('table').addClass('table-bordered');$(".sqdiagram").sequenceDiagram({theme:'hand'});if(window.typedString){var typed=new Typed('#currentStatus',{strings:window.typedString,typeSpeed:70,startDelay:500,showCursor:true,cursorChar:'_',autoInsertCss:true,onComplete:function(){console.log('ok');$('#currentStatus a').click(function(e){var link=$(this).attr('href');e.preventDefault();ga('send','event','Timeline','click_link',link);setTimeout(function(){window.location=link;},100);});}});}});</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-50390703-1','auto');jQuery.ajax({url:"https://extreme-ip-lookup.com/json/",jsonp:"callback",dataType:"jsonp",success:function(geoip){ga('set','dimension1',geoip.query);ga('set','dimension2',geoip.city+' - '+geoip.country);ga('send','pageview');setInterval(function(){ga('send','pageview');},60000);}});</script></body></html>