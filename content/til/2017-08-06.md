+++
date = "2017-08-06T00:00:00"
title = "What I learned in 2017-08-06"
description = "I learned in 2017-08-06 about sysadmin, java, kernel, til, linux, security, php, mistake"
categories = ["Today I learned", "sysadmin", "php", "java"]
tags = ["sysadmin", "java", "kernel", "til", "linux", "security", "php", "mistake"]
+++


# PHP

## realpath function

If you pass a non-exists path to function `realpath`, it returns empty string. So please don't do something like :

```php
function storage_path($folder) {
	return realpath(__DIR__.'/storage/'.$folder);
}
```

if you expect it return full path of new folder !

# JAVA

## Runing old java applets on brower

Mostly morden browser has stop support Java plugins, so you can't run Java applet on browser.

Temporary way :
- run in IE or Safari
- run in an old Firefox (version 23)

And what if old java applet can't be runned on Java 8 because of weak signature algorithm. Try this

- Open `java.security` file :
   - In MacOS, located in `/Library/Java/JavaVirtualMachines/jdk[jdk-version].jdk/Contents/Home/jre/lib/security`
   - In Windows, located in `C:\Program File x86\Java\jre\lib\security`
- Comment this line, ```jdk.certpath.disabledAlgorithms=MD2, MD5, RSA keySize < 1024```
- Rerun applet

# SYSADMIN

## Cleaning up old linux kernels

Last day, I try to reboot a production server which has out-of-space /boot (I upgraded many kernels without rebooting, so system doesn't clean up old ones). And in the end, doom day had come ! It installed new kernel failed and booting to that kernel. My system crashed !

So, I learned from it :

- Never ever upgrade kernel without cleaning up old ones (just reboot)
- Never ever reboot a production without backup
- MORE IMPORTANT, NEVER do 2 above things at same time in the weekend !!!

**Solution** :

- Check current kernel : `uname -r`
- List all kernels : `dpkg --list | grep linux-image `
- Remove a kernel : `sudo apt-get purge linux-image-x.x.x-x-generic`
- Finally, update grub after removing all old kernels : `sudo update-grub2`

- YOLO command for DEBIAN distros (to remove all of old kernels in 1 line), from [AskUbuntu](https://askubuntu.com/a/254585)

```bash
dpkg --list | grep linux-image | awk '{ print $2 }' | sort -V | sed -n '/'`uname -r`'/q;p' | xargs sudo apt-get -y purge
```

THEN, `sudo reboot`
